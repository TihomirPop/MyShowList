import{e as _e}from"../chunks/C3zk5da-.js";import{a as S,c as Ee,b as Ce,i as P,f as Me,h as Le,j as Ve,k as me,l as Ne}from"../chunks/DJ-Tgj2u.js";import{i as Ge,a as je,b as Ae}from"../chunks/CtVqx6bY.js";import{i as We,c as Be,S as xe,v as Ie}from"../chunks/BwEJmP8-.js";import"../chunks/DsnmJJEf.js";import{d as Se,a as ke,s as O,b as Pe,o as He,f,m as c,n as ye,g as o,e as r,i as s,j as e,v as a,z as Ye,A as ge,k as R,y as m,x as se,E as ze,D as qe,a2 as Je,$ as Ke,B as Qe,C as Xe,W as Re}from"../chunks/DDMLW2bY.js";import{e as fe,i as De,a as Ue,f as Ze,g as $e,s as et}from"../chunks/Dyv9doHM.js";import{r as tt,s as be,h as st}from"../chunks/Dq8RMBer.js";import{s as Oe}from"../chunks/CDmXa4e3.js";import{b as Te}from"../chunks/YTz_6Mw-.js";const at=async({params:E})=>{const{id:u}=E;if(!S.token)throw _e(401,"Not authenticated");const[t,d]=await Promise.all([Ee(u,S.token),Ce(S.token)]);if(Ge(t))throw _e(404,"Show not found");if(je(t))throw _e(500,t.message||"Failed to load show");if(!Ae(t))throw _e(500,"Failed to load show");const w=t.show;let b=null;return We(d)&&(b=d.shows.find(D=>D.show.id===u)??null),{show:w,userShow:b}},qt=Object.freeze(Object.defineProperty({__proto__:null,load:at},Symbol.toStringTag,{value:"Module"}));function rt(E){return Array.isArray(E)}function ot(E){return!("message"in E)}function nt(E){return!("message"in E)}var it=f('<div class="loading-container"><div class="loading-spinner"></div> <p>Loading reviews...</p></div>'),lt=f('<div class="error-state svelte-bpdc55"><p class="error-message svelte-bpdc55"> </p> <button class="btn-primary retry-button">Try Again</button></div>'),vt=f('<p class="submit-error svelte-bpdc55"> </p>'),dt=f('<button class="btn-secondary">Cancel</button>'),ct=f('<div class="review-form svelte-bpdc55"><h3 class="svelte-bpdc55"> </h3> <textarea placeholder="Share your thoughts about this show..." rows="5" maxlength="10000" class="review-textarea svelte-bpdc55"></textarea> <div class="form-footer svelte-bpdc55"><span> </span> <!> <div class="form-actions svelte-bpdc55"><!> <button class="btn-primary"> </button></div></div></div>'),ut=f('<div class="review-card user-review svelte-bpdc55"><div class="review-header svelte-bpdc55"><span class="review-username svelte-bpdc55"> </span></div> <p class="review-text svelte-bpdc55"> </p> <div class="review-actions svelte-bpdc55"><button class="action-button edit-button svelte-bpdc55">‚úèÔ∏è Edit</button> <button class="action-button delete-button svelte-bpdc55">üóëÔ∏è Delete</button></div></div>'),pt=f('<div class="review-card svelte-bpdc55"><div class="review-header svelte-bpdc55"><span class="review-username svelte-bpdc55"> </span></div> <p class="review-text svelte-bpdc55"> </p></div>'),ht=f('<div class="reviews-list svelte-bpdc55"><h3 class="svelte-bpdc55">Other Reviews</h3> <!></div>'),_t=f('<div class="empty-state svelte-bpdc55"><p class="svelte-bpdc55">No reviews yet.</p> <p class="hint svelte-bpdc55">Be the first to review this show!</p></div>'),mt=f("<!> <!> <!> <!>",1),ft=f('<div class="reviews-section svelte-bpdc55"><h2 class="svelte-bpdc55">Reviews</h2> <!></div>');function wt(E,u){ke(u,!0);let t=O(Pe([])),d=O(!0),w=O(null),b=O(""),y=O(!1),D=O(!1),N=O(null);const ie=se(()=>S.user?.username),W=se(()=>e(t).find(n=>n.username===e(ie))),le=se(()=>!!e(W)),Q=se(()=>e(t).filter(n=>n.username!==e(ie))),X=se(()=>e(b).trim().length>0&&e(b).length<=1e4);He(async()=>{await q()});async function q(){if(s(d,!0),s(w,null),!S.token){s(w,"Please login to view reviews"),s(d,!1);return}const n=await Me(u.showId,S.token);rt(n)?s(t,n,!0):s(w,"Failed to load reviews"),s(d,!1)}async function ae(){if(!e(X)||!S.token)return;s(y,!0),s(N,null);const n=await Le(u.showId,e(b),S.token);if(ot(n))await q(),s(b,""),s(D,!1);else{const p=n;s(N,"message"in p?p.message:"Failed to submit review",!0)}s(y,!1)}async function Z(){e(W)&&(s(b,e(W).reviewText,!0),s(D,!0))}function re(){s(b,""),s(D,!1),s(N,null)}async function ve(){if(!S.token||!confirm("Are you sure you want to delete your review?"))return;s(y,!0),s(N,null);const n=await Ve(u.showId,S.token);nt(n)?(await q(),s(b,""),s(D,!1)):s(N,"Failed to delete review"),s(y,!1)}var oe=ft(),pe=o(r(oe),2);{var v=n=>{var p=it();c(n,p)},l=n=>{var p=Ye(),de=ge(p);{var $=F=>{var L=lt(),V=r(L),J=r(V,!0);a(V);var B=o(V,2);B.__click=q,a(L),R(()=>m(J,e(w))),c(F,L)},M=F=>{var L=mt(),V=ge(L);{var J=x=>{var A=ct(),h=r(A),k=r(h,!0);a(h);var g=o(h,2);ze(g);var U=o(g,2),I=r(U);let H;var ee=r(I);a(I);var i=o(I,2);{var _=G=>{var j=vt(),he=r(j,!0);a(j),R(()=>m(he,e(N))),c(G,j)};P(i,G=>{e(N)&&G(_)})}var T=o(i,2),Y=r(T);{var z=G=>{var j=dt();j.__click=re,R(()=>j.disabled=e(y)),c(G,j)};P(Y,G=>{e(D)&&G(z)})}var te=o(Y,2);te.__click=ae;var we=r(te,!0);a(te),a(T),a(U),a(A),R(()=>{m(k,e(D)?"Edit Your Review":"Write a Review"),g.disabled=e(y),H=Oe(I,1,"char-count svelte-bpdc55",null,H,{warning:e(b).length>9500}),m(ee,`${e(b).length??""} / 10,000`),te.disabled=!e(X)||e(y),m(we,e(y)?"Submitting...":e(D)?"Update Review":"Submit Review")}),Te(g,()=>e(b),G=>s(b,G)),c(x,A)};P(V,x=>{S.token&&(!e(le)||e(D))&&x(J)})}var B=o(V,2);{var C=x=>{var A=ut(),h=r(A),k=r(h),g=r(k);a(k),a(h);var U=o(h,2),I=r(U,!0);a(U);var H=o(U,2),ee=r(H);ee.__click=Z;var i=o(ee,2);i.__click=ve,a(H),a(A),R(()=>{m(g,`${e(W).username??""} (You)`),m(I,e(W).reviewText)}),c(x,A)};P(B,x=>{e(W)&&!e(D)&&x(C)})}var K=o(B,2);{var ne=x=>{var A=ht(),h=o(r(A),2);fe(h,17,()=>e(Q),k=>k.username,(k,g)=>{var U=pt(),I=r(U),H=r(I),ee=r(H,!0);a(H),a(I);var i=o(I,2),_=r(i,!0);a(i),a(U),R(()=>{m(ee,e(g).username),m(_,e(g).reviewText)}),c(k,U)}),a(A),c(x,A)};P(K,x=>{e(Q).length>0&&x(ne)})}var ce=o(K,2);{var ue=x=>{var A=_t();c(x,A)};P(ce,x=>{e(t).length===0&&x(ue)})}c(F,L)};P(de,F=>{e(w)?F($):F(M,!1)},!0)}c(n,p)};P(pe,n=>{e(d)?n(v):n(l,!1)})}a(oe),c(E,oe),ye()}Se(["click"]);var gt=f('<button class="btn-primary add-to-list-button"> </button>'),bt=f("<option> </option>"),St=f("<option> </option>"),kt=f('<span class="error-text svelte-6pkm26"> </span>'),yt=f('<div class="user-show-controls svelte-6pkm26"><div class="control-group svelte-6pkm26"><label for="status-select" class="control-label svelte-6pkm26">Status:</label> <select id="status-select" class="status-select svelte-6pkm26"></select></div> <div class="control-group svelte-6pkm26"><label for="score-select" class="control-label svelte-6pkm26">Score:</label> <select id="score-select" class="score-select svelte-6pkm26"><option>Select</option><!></select></div> <div class="control-group svelte-6pkm26"><label for="progress-input" class="control-label svelte-6pkm26">Progress:</label> <div class="progress-input-wrapper svelte-6pkm26"><input id="progress-input" type="number" min="0"/> <span class="progress-total svelte-6pkm26"> </span> <button class="progress-increment-button svelte-6pkm26" title="Increment by 1">+</button></div> <!></div></div>'),xt=f('<div class="update-error svelte-6pkm26"> </div>'),It=f('<div class="user-show-section svelte-6pkm26"><!> <!></div>');function Rt(E,u){ke(u,!0);let t=O(null),d=O(!1),w=O(null),b=O("0"),y=O(null);qe(()=>{s(t,u.initialUserShow,!0),u.initialUserShow&&s(b,u.initialUserShow.progress.toString(),!0)});const D=se(()=>u.show.type==="MOVIE"?1:u.show.type==="TV_SERIES"?u.show.episodeCount:null);async function N(){if(!S.token)return;s(d,!0),s(w,null);const v=await me({showId:u.showId,progress:0,status:xe.WATCHING,score:0},S.token);"message"in v?s(w,v.message||"Failed to add show",!0):(s(t,{show:u.show,progress:0,status:xe.WATCHING,score:0},!0),s(b,"0")),s(d,!1)}async function ie(v){if(!S.token||!e(t))return;const l=v.target,n=l.value;s(d,!0),s(w,null);const p=await me({showId:u.showId,progress:e(t).progress,status:n,score:e(t).score},S.token);"message"in p?(s(w,p.message||"Failed to update status",!0),l.value=e(t).status):s(t,{...e(t),status:n},!0),s(d,!1)}async function W(v){if(!S.token||!e(t))return;const l=v.target,n=parseInt(l.value,10);s(d,!0),s(w,null);const p=await me({showId:u.showId,progress:e(t).progress,status:e(t).status,score:n},S.token);"message"in p?(s(w,p.message||"Failed to update score",!0),l.value=e(t).score.toString()):(s(t,{...e(t),score:n},!0),u.onScoreUpdated&&u.onScoreUpdated()),s(d,!1)}async function le(v){if(!S.token||!e(t))return;s(d,!0),s(w,null),s(y,null);const l=await me({showId:u.showId,progress:v,status:e(t).status,score:e(t).score},S.token);"message"in l?(s(w,l.message||"Failed to update progress",!0),s(b,e(t).progress.toString(),!0)):(s(t,{...e(t),progress:v},!0),s(b,v.toString(),!0)),s(d,!1)}async function Q(v){if(v.key!=="Enter"||!e(t))return;const l=Ie(e(b),e(D));if(!l.valid){s(y,l.error??null,!0);return}const n=l.progress;if(n===e(t).progress){s(y,null);return}await le(n)}async function X(){if(!e(t))return;const v=e(t).progress+1,l=Ie(v.toString(),e(D));if(!l.valid){s(y,l.error??null,!0);return}await le(v)}function q(){s(y,null)}var ae=It(),Z=r(ae);{var re=v=>{var l=gt();l.__click=N;var n=r(l,!0);a(l),R(()=>{l.disabled=e(d),m(n,e(d)?"Adding...":"+ Add to List")}),c(v,l)},ve=v=>{var l=yt(),n=r(l),p=o(r(n),2);p.__change=ie,fe(p,21,Be,h=>h.value,(h,k)=>{var g=bt(),U=r(g,!0);a(g);var I={};R(()=>{m(U,e(k).label),I!==(I=e(k).value)&&(g.value=(g.__value=e(k).value)??"")}),c(h,g)}),a(p);var de;De(p),a(n);var $=o(n,2),M=o(r($),2);M.__change=W;var F=r(M);F.value=F.__value=0;var L=o(F);fe(L,16,()=>[1,2,3,4,5,6,7,8,9,10],h=>h,(h,k)=>{var g=St(),U=r(g,!0);a(g);var I={};R(()=>{m(U,k),I!==(I=k)&&(g.value=(g.__value=k)??"")}),c(h,g)}),a(M);var V;De(M),a($);var J=o($,2),B=o(r(J),2),C=r(B);tt(C);let K;C.__keydown=Q,C.__input=q;var ne=o(C,2),ce=r(ne);a(ne);var ue=o(ne,2);ue.__click=X,a(B);var x=o(B,2);{var A=h=>{var k=kt(),g=r(k,!0);a(k),R(()=>m(g,e(y))),c(h,k)};P(x,h=>{e(y)&&h(A)})}a(J),a(l),R(()=>{p.disabled=e(d),de!==(de=e(t).status)&&(p.value=(p.__value=e(t).status)??"",Ue(p,e(t).status)),M.disabled=e(d),V!==(V=e(t).score)&&(M.value=(M.__value=e(t).score)??"",Ue(M,e(t).score)),be(C,"max",e(D)??void 0),K=Oe(C,1,"progress-input svelte-6pkm26",null,K,{"has-error":e(y)!==null}),C.disabled=e(d),m(ce,`/ ${e(D)??"?"??""}`),ue.disabled=e(d)}),Te(C,()=>e(b),h=>s(b,h)),c(v,l)};P(Z,v=>{e(t)===null?v(re):v(ve,!1)})}var oe=o(Z,2);{var pe=v=>{var l=xt(),n=r(l,!0);a(l),R(()=>m(n,e(w))),c(v,l)};P(oe,v=>{e(w)&&v(pe)})}a(ae),c(E,ae),ye()}Se(["click","change","keydown","input"]);function Dt(E){return!("message"in E)}function Ut(E){return"message"in E}var Et=f('<img class="show-thumbnail-image svelte-1mhr431"/>'),At=f('<div class="show-thumbnail-placeholder svelte-1mhr431"></div>'),Pt=f('<div class="error-banner"> </div>'),Ot=f('<div class="admin-actions svelte-1mhr431"><button class="btn-primary svelte-1mhr431">Edit Show</button> <button class="btn-danger svelte-1mhr431"> </button></div> <!>',1),Tt=f('<div class="meta-item svelte-1mhr431"><span class="meta-label svelte-1mhr431">Episodes:</span> <span class="meta-value svelte-1mhr431"> </span></div>'),Ft=f('<span class="genre-tag svelte-1mhr431"> </span>'),Ct=f('<div class="show-genres svelte-1mhr431"></div>'),Mt=f('<div class="container svelte-1mhr431"><nav class="breadcrumb svelte-1mhr431"><a href="/" class="svelte-1mhr431">Home</a> <span class="separator svelte-1mhr431">/</span> <span class="current svelte-1mhr431"> </span></nav> <div class="show-header svelte-1mhr431"><div class="show-thumbnail-container svelte-1mhr431"><!> <span class="show-type-badge svelte-1mhr431"> </span></div> <div class="show-main-info"><h1 class="show-title svelte-1mhr431"> </h1> <!> <div class="show-meta svelte-1mhr431"><div class="meta-item svelte-1mhr431"><span class="meta-label svelte-1mhr431">Rating:</span> <div class="show-score svelte-1mhr431"><span class="score-icon svelte-1mhr431">‚≠ê</span> <span class="score-value svelte-1mhr431"> </span></div></div> <div class="meta-item svelte-1mhr431"><span class="meta-label svelte-1mhr431"> </span> <span class="meta-value svelte-1mhr431"> </span></div> <!></div> <!> <!></div></div> <div class="show-description-section svelte-1mhr431"><h2 class="svelte-1mhr431">Description</h2> <p class="show-description svelte-1mhr431"> </p></div> <!></div>');function Jt(E,u){ke(u,!0);let t=O(Pe(u.data.show)),d=O(!1),w=O(null);const b=se(()=>S.user?.role==="ADMIN");let y=O(!1);function D(){s(y,!0)}async function N(){if(!S.token)return;const i=await Ee(e(t).id,S.token);Ae(i)&&s(t,i.show,!0)}function ie(){Re(`/shows/${e(t).id}/edit`)}async function W(){if(!confirm("Are you sure you want to delete this show? This action cannot be undone."))return;if(!S.token){s(w,"Authentication required");return}s(d,!0),s(w,null);const i=await Ne(e(t).id,S.token);Dt(i)?Re("/"):Ut(i)?(s(w,i.message,!0),s(d,!1)):(s(w,"Show not found"),s(d,!1))}const le=se(()=>{if(e(t).type==="MOVIE")return new Date(e(t).releaseDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});const i=e(t).startDate?new Date(e(t).startDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Unknown",_=e(t).endDate?new Date(e(t).endDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Ongoing";return`${i} - ${_}`});var Q=Mt();st("1mhr431",i=>{Je(()=>{Ke.title=`${e(t).title??""} - MyShowList`})});var X=r(Q),q=o(r(X),4),ae=r(q,!0);a(q),a(X);var Z=o(X,2),re=r(Z),ve=r(re);{var oe=i=>{var _=Et();R(()=>{be(_,"src",e(t).thumbnailUrl),be(_,"alt",`${e(t).title??""} poster`)}),Qe("error",_,D),Xe(_),c(i,_)},pe=i=>{var _=At();R(T=>et(_,`background: ${T??""};`),[()=>$e(0)]),c(i,_)};P(ve,i=>{!e(y)&&e(t).thumbnailUrl?i(oe):i(pe,!1)})}var v=o(ve,2),l=r(v,!0);a(v),a(re);var n=o(re,2),p=r(n),de=r(p,!0);a(p);var $=o(p,2);{var M=i=>{var _=Ot(),T=ge(_),Y=r(T);Y.__click=ie;var z=o(Y,2);z.__click=W;var te=r(z,!0);a(z),a(T);var we=o(T,2);{var G=j=>{var he=Pt(),Fe=r(he,!0);a(he),R(()=>m(Fe,e(w))),c(j,he)};P(we,j=>{e(w)&&j(G)})}R(()=>{Y.disabled=e(d),z.disabled=e(d),m(te,e(d)?"Deleting...":"Delete Show")}),c(i,_)};P($,i=>{e(b)&&i(M)})}var F=o($,2),L=r(F),V=o(r(L),2),J=o(r(V),2),B=r(J,!0);a(J),a(V),a(L);var C=o(L,2),K=r(C),ne=r(K,!0);a(K);var ce=o(K,2),ue=r(ce,!0);a(ce),a(C);var x=o(C,2);{var A=i=>{var _=Tt(),T=o(r(_),2),Y=r(T,!0);a(T),a(_),R(()=>m(Y,e(t).episodeCount)),c(i,_)};P(x,i=>{e(t).type==="TV_SERIES"&&e(t).episodeCount&&i(A)})}a(F);var h=o(F,2);{var k=i=>{var _=Ct();fe(_,20,()=>e(t).genres,T=>T,(T,Y)=>{var z=Ft(),te=r(z,!0);a(z),R(()=>m(te,Y)),c(T,z)}),a(_),c(i,_)};P(h,i=>{e(t).genres.length>0&&i(k)})}var g=o(h,2);Rt(g,{get showId(){return e(t).id},get initialUserShow(){return u.data.userShow},get show(){return e(t)},onScoreUpdated:N}),a(n),a(Z);var U=o(Z,2),I=o(r(U),2),H=r(I,!0);a(I),a(U);var ee=o(U,2);wt(ee,{get showId(){return e(t).id}}),a(Q),R(i=>{m(ae,e(t).title),m(l,e(t).type==="MOVIE"?"Movie":"TV Series"),m(de,e(t).title),m(B,i),m(ne,e(t).type==="MOVIE"?"Release Date:":"Years:"),m(ue,e(le)),m(H,e(t).description)},[()=>Ze(e(t).averageScore)]),c(E,Q),ye()}Se(["click"]);export{Jt as component,qt as universal};
