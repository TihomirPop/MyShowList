import{e as oe}from"../chunks/BhhEXevh.js";import{a as D,i as S,e as Te,d as Me}from"../chunks/DCGF0svJ.js";import"../chunks/DsnmJJEf.js";import{aB as Ue,G as Oe,h as Ve,X as Ge,a1 as $e,d as Fe,a as Ne,s as b,b as Le,f as g,e as l,j as e,m as h,n as je,i as s,x as Y,q as xe,g as n,$ as Pe,v as i,W as ue,k as q,y as C,A as qe}from"../chunks/DT7DyGpg.js";import{e as ce}from"../chunks/DVctERAW.js";import{h as Be,r as We,s as V}from"../chunks/B_ysz1NM.js";import{s as ve}from"../chunks/DTy2aNmC.js";import{b as Ye}from"../chunks/CCDdTn80.js";import{S as ze}from"../chunks/Qi3ejFva.js";import{A as He}from"../chunks/CtVqx6bY.js";function Ke(r,k,d){Ve&&Ge();var _=new $e(r),p=!Ue();Oe(()=>{var o=k();p&&o!==null&&typeof o=="object"&&(o={}),_.ensure(o,d)})}const Qe=async()=>{if(!D.token||!D.user)throw oe(401,"Not authenticated");if(D.user.role!=="ADMIN")throw oe(403,"You do not have permission to access this page");return{}},At=Object.freeze(Object.defineProperty({__proto__:null,load:Qe},Symbol.toStringTag,{value:"Module"}));function Xe(r){return"showId"in r}function Je(r){return"missingGenres"in r}function Ze(r){return"message"in r&&!("missingGenres"in r)}function et(r){return"tvSeries"in r&&"movies"in r}function tt(r){return"message"in r}function st(r){const k=r.genres.filter(d=>He.includes(d));return r.type==="MOVIE"?{type:"MOVIE",id:r.id,title:r.title,description:r.description,genres:k,averageScore:r.averageScore,thumbnailUrl:r.thumbnailUrl,releaseDate:r.releaseDate}:{type:"TV_SERIES",id:r.id,title:r.title,description:r.description,genres:k,averageScore:r.averageScore,thumbnailUrl:r.thumbnailUrl,episodeCount:r.episodeCount,startDate:r.startDate,endDate:r.endDate}}function rt(r,k){let d=null;return function(...p){d!==null&&clearTimeout(d),d=setTimeout(()=>{r(...p),d=null},k)}}var at=g('<span class="search-spinner svelte-w2gluk" aria-label="Searching..."></span>'),lt=g('<button type="button" class="clear-search-btn svelte-w2gluk" aria-label="Clear search">✕</button>'),it=g('<div class="search-error svelte-w2gluk" role="alert"> </div>'),nt=g('<div class="no-results svelte-w2gluk"> </div>'),ot=g('<button type="button" role="option"><div class="result-thumbnail svelte-w2gluk"><img class="svelte-w2gluk"/></div> <div class="result-info svelte-w2gluk"><div class="result-title svelte-w2gluk"> </div> <div class="result-meta svelte-w2gluk"><span class="result-type-badge tv svelte-w2gluk">TV Series</span> <span class="result-episodes"> </span></div></div></button>'),ut=g('<div class="results-section svelte-w2gluk"><h3 class="results-heading svelte-w2gluk">TV Series</h3> <!></div>'),ct=g('<button type="button" role="option"><div class="result-thumbnail svelte-w2gluk"><img class="svelte-w2gluk"/></div> <div class="result-info svelte-w2gluk"><div class="result-title svelte-w2gluk"> </div> <div class="result-meta svelte-w2gluk"><span class="result-type-badge movie svelte-w2gluk">Movie</span> <span class="result-date"> </span></div></div></button>'),vt=g('<div class="results-section svelte-w2gluk"><h3 class="results-heading svelte-w2gluk">Movies</h3> <!></div>'),dt=g("<!> <!>",1),pt=g('<div id="search-results" class="search-results svelte-w2gluk" role="listbox" aria-label="Search results"><!></div>'),ht=g('<div class="selected-show-banner svelte-w2gluk">✓ Form pre-filled with: <strong> </strong> <button type="button" class="clear-selection-btn svelte-w2gluk">Clear and start over</button></div>'),gt=g(`<div class="container svelte-w2gluk"><nav class="breadcrumb svelte-w2gluk"><a href="/" class="svelte-w2gluk">Home</a> <span class="separator svelte-w2gluk">/</span> <span class="current svelte-w2gluk">Add Show</span></nav> <div class="search-section svelte-w2gluk"><h2 class="svelte-w2gluk">Search External Database (Optional)</h2> <p class="search-hint svelte-w2gluk">Search for a show to automatically populate the form below, or skip this step to create a
			show manually.</p> <div class="search-container svelte-w2gluk"><div class="search-input-wrapper svelte-w2gluk"><input type="text" placeholder="Search for movies or TV series..." class="search-input svelte-w2gluk" aria-label="Search for shows" aria-describedby="search-help" aria-autocomplete="list" aria-controls="search-results"/> <!> <!></div> <span id="search-help" class="search-help svelte-w2gluk">Start typing to search. Results limited to 5 TV series and 5 movies.</span> <!> <!></div> <!></div> <div class="form-divider svelte-w2gluk"><span class="svelte-w2gluk">OR</span></div> <!></div>`);function It(r,k){Ne(k,!0);let d=b(!1),_=b(Le({})),p=b(""),o=b(null),z=b(!1),m=b(null),w=b(!1),T=b(null),c=b(-1);const re=Y(()=>e(o)!==null&&(e(o).tvSeries.length>0||e(o).movies.length>0)),M=Y(()=>e(o)?.tvSeries.slice(0,5)||[]),B=Y(()=>e(o)?.movies.slice(0,5)||[]),ae=Y(()=>e(M).length+e(B).length);async function de(t){if(s(_,{},!0),!D.token){s(_,{general:"Not authenticated"},!0);return}s(d,!0);try{const a=t.showType==="MOVIE"?{type:"MOVIE",title:t.title.trim(),description:t.description.trim(),thumbnailUrl:t.thumbnailUrl.trim(),genres:Array.from(t.selectedGenres),releaseDate:t.releaseDate}:{type:"TV_SERIES",title:t.title.trim(),description:t.description.trim(),thumbnailUrl:t.thumbnailUrl.trim(),genres:Array.from(t.selectedGenres),episodeCount:Number(t.episodeCount),startDate:t.startDate,endDate:t.endDate.trim()===""?null:t.endDate},u=await Me(a,D.token);if(Xe(u)){ue(`/shows/${u.showId}`);return}if(Je(u)){s(_,{genres:`The following genres do not exist: ${u.missingGenres.join(", ")}`},!0);return}if(Ze(u)){s(_,{general:u.message},!0);return}s(_,{general:"An unexpected error occurred"},!0)}catch(a){s(_,{general:a instanceof Error?a.message:"An unexpected error occurred"},!0)}finally{s(d,!1)}}function pe(){ue("/")}const he=rt(async t=>{if(!D.token){s(m,"Authentication required");return}if(t.trim().length===0){s(o,null),s(m,null),s(w,!1);return}s(z,!0),s(m,null);try{const a=await Te(t.trim(),D.token);et(a)?(s(o,a,!0),s(w,!0),s(m,null)):tt(a)&&(s(m,a.message,!0),s(o,null),s(w,!1))}catch(a){s(m,a instanceof Error?a.message:"Search failed",!0),s(o,null),s(w,!1)}finally{s(z,!1)}},400);function ge(t){const a=t.target;s(p,a.value,!0),he(e(p))}function H(t){s(T,st(t),!0),s(p,""),s(o,null),s(w,!1),s(m,null),s(c,-1)}function le(){s(p,""),s(o,null),s(w,!1),s(m,null),s(T,null),s(c,-1)}function fe(t){if(!(!e(w)||!e(re)))switch(t.key){case"ArrowDown":t.preventDefault(),s(c,(e(c)+1)%e(ae));break;case"ArrowUp":t.preventDefault(),s(c,e(c)<=0?e(ae)-1:e(c)-1,!0);break;case"Enter":if(t.preventDefault(),e(c)>=0){const a=[...e(M),...e(B)];H(a[e(c)])}break;case"Escape":t.preventDefault(),s(w,!1),s(c,-1);break}}var K=gt();Be("w2gluk",t=>{xe(()=>{Pe.title="Add Show - MyShowList"})});var Q=n(l(K),2),X=n(l(Q),4),J=l(X),G=l(J);We(G),G.__input=ge,G.__keydown=fe;var ie=n(G,2);{var _e=t=>{var a=at();h(t,a)};S(ie,t=>{e(z)&&t(_e)})}var me=n(ie,2);{var we=t=>{var a=lt();a.__click=le,h(t,a)};S(me,t=>{e(p).length>0&&t(we)})}i(J);var ne=n(J,4);{var be=t=>{var a=it(),u=l(a,!0);i(a),q(()=>C(u,e(m))),h(t,a)};S(ne,t=>{e(m)&&t(be)})}var ke=n(ne,2);{var Se=t=>{var a=pt(),u=l(a);{var $=U=>{var O=nt(),W=l(O);i(O),q(()=>C(W,`No results found for "${e(p)??""}"`)),h(U,O)},Z=U=>{var O=dt(),W=qe(O);{var Ae=y=>{var E=ut(),ee=n(l(E),2);ce(ee,19,()=>e(M),R=>R.id,(R,f,F)=>{var v=ot();let N;v.__click=()=>H(e(f));var A=l(v),L=l(A);i(A);var j=n(A,2),I=l(j),te=l(I,!0);i(I);var x=n(I,2),P=n(l(x),2),se=l(P);i(P),i(x),i(j),i(v),q(()=>{N=ve(v,1,"result-item svelte-w2gluk",null,N,{focused:e(c)===e(F)}),V(v,"aria-selected",e(c)===e(F)),V(L,"src",e(f).thumbnailUrl),V(L,"alt",`${e(f).title??""} poster`),C(te,e(f).title),C(se,`${e(f).episodeCount??""} episodes`)}),h(R,v)}),i(E),h(y,E)};S(W,y=>{e(M).length>0&&y(Ae)})}var Ie=n(W,2);{var Ce=y=>{var E=vt(),ee=n(l(E),2);ce(ee,19,()=>e(B),R=>R.id,(R,f,F)=>{var v=ct();let N;v.__click=()=>H(e(f));var A=l(v),L=l(A);i(A);var j=n(A,2),I=l(j),te=l(I,!0);i(I);var x=n(I,2),P=n(l(x),2),se=l(P,!0);i(P),i(x),i(j),i(v),q(De=>{N=ve(v,1,"result-item svelte-w2gluk",null,N,{focused:e(c)===e(M).length+e(F)}),V(v,"aria-selected",e(c)===e(M).length+e(F)),V(L,"src",e(f).thumbnailUrl),V(L,"alt",`${e(f).title??""} poster`),C(te,e(f).title),C(se,De)},[()=>new Date(e(f).releaseDate).getFullYear()]),h(R,v)}),i(E),h(y,E)};S(Ie,y=>{e(B).length>0&&y(Ce)})}h(U,O)};S(u,U=>{e(re)?U(Z,!1):U($)})}i(a),h(t,a)};S(ke,t=>{e(w)&&t(Se)})}i(X);var ye=n(X,2);{var Ee=t=>{var a=ht(),u=n(l(a)),$=l(u,!0);i(u);var Z=n(u,2);Z.__click=le,i(a),q(()=>C($,e(T).title)),h(t,a)};S(ye,t=>{e(T)&&t(Ee)})}i(Q);var Re=n(Q,4);Ke(Re,()=>e(T)?.id||"new",t=>{ze(t,{mode:"create",get initialData(){return e(T)},get isLoading(){return e(d)},get errors(){return e(_)},onSubmit:de,onCancel:pe})}),i(K),Ye(G,()=>e(p),t=>s(p,t)),h(r,K),je()}Fe(["input","keydown","click"]);export{It as component,At as universal};
