import{G as E,h as m,X as T,Y as I,Z as x,_ as P,a0 as v,N as _,a1 as k,M as l,s as p,j as y,i as w,W as b}from"./DT7DyGpg.js";function N(t,s,e=!1){m&&T();var r=new k(t),n=e?I:0;function a(o,u){if(m){const S=x(t)===P;if(o===S){var f=v();_(f),r.anchor=f,l(!1),r.ensure(o,u),l(!0);return}}r.ensure(o,u)}E(()=>{var o=!1;s((u,f=!0)=>{o=!0,a(f,u)}),o||a(!1,null)},n)}const g="http://localhost:8080/api/v1";class i extends Error{constructor(s,e){super(s),this.status=e,this.name="ApiError"}}async function h(t,s={},e){const r={"Content-Type":"application/json"};e&&(r.Authorization=`Bearer ${e}`);const n=await fetch(`${g}${t}`,{...s,headers:r});if(!n.ok){if(n.status===404)throw new i("Not found",n.status);const u=n.headers.get("content-type");if(u&&u.includes("application/json")){const f=await n.json();throw new i(f.message||"Request failed",n.status)}throw new i("Request failed",n.status)}if(n.status===204)return{};const a=n.headers.get("content-type");return!a||!a.includes("application/json")?{}:await n.json()}async function $(t){return h("/login",{method:"POST",body:JSON.stringify(t)})}async function O(t){return h("/register",{method:"POST",body:JSON.stringify(t)})}async function c(t,s,e={}){return h(t,e,s)}async function R(t){return c("/shows",t,{method:"GET"})}async function J(t,s){try{return await c(`/shows/${t}`,s,{method:"GET"})}catch(e){return e instanceof i?e.status===404?{}:{message:e.message}:{message:e instanceof Error?e.message:"An unexpected error occurred"}}}async function L(t,s){try{return await c(`/shows/${t}/reviews`,s,{method:"GET"})}catch(e){return e instanceof i?e.status===404?{}:{message:e.message}:{message:e instanceof Error?e.message:"An unexpected error occurred"}}}async function U(t,s,e){try{return await c(`/shows/${t}/reviews`,e,{method:"POST",body:JSON.stringify({reviewText:s})}),{}}catch(r){return r instanceof i?r.status===404?{}:r.status===400?{message:r.message}:{message:r.message}:{message:r instanceof Error?r.message:"An unexpected error occurred"}}}async function B(t,s){try{return await c(`/shows/${t}/reviews`,s,{method:"DELETE"}),{}}catch(e){return e instanceof i?e.status===404?{}:{message:e.message}:{message:e instanceof Error?e.message:"An unexpected error occurred"}}}async function q(t){try{return await c("/user-shows",t,{method:"GET"})}catch(s){return s instanceof i?s.status===404?{}:{message:s.message}:{message:s instanceof Error?s.message:"An unexpected error occurred"}}}async function C(t,s){try{return await c("/user-shows",s,{method:"POST",body:JSON.stringify(t)}),{}}catch(e){return e instanceof i?e.status===404?{}:e.status===400?{message:e.message}:{message:e.message}:{message:e instanceof Error?e.message:"An unexpected error occurred"}}}async function D(t,s){try{const e=await fetch(`${g}/shows`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(t)});if(e.status===201){const r=e.headers.get("Location");if(!r)return{message:"Show created but Location header not found"};const n=r.split("/").filter(o=>o.length>0),a=n[n.length-1];return a?{showId:a}:{message:"Show created but could not extract ID from Location header"}}if(e.status===400){const n=(await e.json()).message||"Validation failed";return n.startsWith("Genres not found:")?{missingGenres:n.replace("Genres not found:","").trim().split(",").map(u=>u.trim())}:{message:n}}return e.status===403?{message:"You do not have permission to create shows"}:e.status===500?{message:(await e.json()).message||"Server error"}:{message:`Unexpected response: ${e.status}`}}catch(e){return{message:e instanceof Error?e.message:"An unexpected error occurred"}}}async function Y(t,s){try{return await c(`/shows/${t}`,s,{method:"DELETE"}),{}}catch(e){return e instanceof i?e.status===404?{}:{message:e.message}:{message:e instanceof Error?e.message:"An unexpected error occurred"}}}async function F(t,s,e){try{const r=await fetch(`${g}/shows/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(s)});if(r.status===200)return{};if(r.status===400){const a=(await r.json()).message||"Validation failed";return a.startsWith("Genres not found:")?{missingGenres:a.replace("Genres not found:","").trim().split(",").map(f=>f.trim())}:{message:a}}return r.status===404?{}:r.status===403?{message:"You do not have permission to edit shows"}:r.status===500?{message:(await r.json()).message||"Server error"}:{message:`Unexpected response: ${r.status}`}}catch(r){return{message:r instanceof Error?r.message:"An unexpected error occurred"}}}async function W(t,s){try{const e=encodeURIComponent(t);return await c(`/external-search?query=${e}`,s,{method:"GET"})}catch(e){return e instanceof i?{type:"Failure",message:e.message}:{type:"Failure",message:e instanceof Error?e.message:"An unexpected error occurred"}}}const d="auth_token";function A(t){try{const s=t.split(".");if(s.length!==3)return null;const e=JSON.parse(atob(s[1]));return e.exp&&e.exp*1e3<Date.now()||!e.sub||!e.role?null:{username:e.sub,role:e.role}}catch{return null}}class G{#e=p(null);get user(){return y(this.#e)}set user(s){w(this.#e,s,!0)}#s=p(null);get token(){return y(this.#s)}set token(s){w(this.#s,s,!0)}get isAuthenticated(){return this.user!==null&&this.token!==null}async login(s,e){try{const r=await $({username:s,password:e});if(!r.token)return{success:!1,error:r.message||"Login failed"};this.token=r.token,localStorage.setItem(d,r.token);const n=A(r.token);return n?(this.user={username:n.username,role:n.role},{success:!0}):(this.logout(),{success:!1,error:"Invalid token received"})}catch(r){return r instanceof Error?{success:!1,error:r.message}:{success:!1,error:"An unexpected error occurred"}}}logout(){this.user=null,this.token=null,localStorage.removeItem(d),b("/login")}initAuth(){const s=localStorage.getItem(d);if(s){const e=A(s);e?(this.token=s,this.user={username:e.username,role:e.role}):localStorage.removeItem(d)}}async register(s,e){try{const r=await O({username:s,password:e});return r.message?{success:!1,error:r.message||"Register failed"}:{success:!0}}catch(r){return r instanceof Error?{success:!1,error:r.message}:{success:!1,error:"An unexpected error occurred"}}}}const z=new G;export{z as a,q as b,J as c,D as d,W as e,L as f,R as g,U as h,N as i,B as j,C as k,Y as l,F as u};
